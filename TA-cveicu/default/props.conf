# TA-cveicu props.conf
# Field extractions and timestamp settings for CVE V5 records

#
# CVE Record Sourcetype
#
[cveicu:record]
SHOULD_LINEMERGE = false
LINE_BREAKER = ([\r\n]+)
NO_BINARY_CHECK = true
# Use the timestamp from the modular input event stream
DATETIME_CONFIG = CURRENT
TZ = UTC
TRUNCATE = 0
KV_MODE = json

# Field extractions using SPATH for nested JSON
EVAL-cve_id = json_extract(_raw, "$.cveMetadata.cveId")
EVAL-state = json_extract(_raw, "$.cveMetadata.state")
EVAL-date_published = json_extract(_raw, "$.cveMetadata.datePublished")
EVAL-date_updated = json_extract(_raw, "$.cveMetadata.dateUpdated")
EVAL-assigner = json_extract(_raw, "$.cveMetadata.assignerShortName")

# CNA container fields
EVAL-title = json_extract(_raw, "$.containers.cna.title")

# Computed CVSS score - Use best available CVSS version
EVAL-cvss_score = coalesce(cvss_v40_score, cvss_v31_score, cvss_v30_score, cvss_v20_score)
EVAL-cvss_severity = coalesce(cvss_v40_severity, cvss_v31_severity, cvss_v30_severity)

# CIM Vulnerabilities Data Model field aliases
# Reference: https://docs.splunk.com/Documentation/CIM/latest/User/Vulnerabilities
FIELDALIAS-vulnerability_id = cve_id AS vulnerability_id
FIELDALIAS-cvss = cvss_score AS cvss
FIELDALIAS-severity_id = cvss_score AS severity_id
FIELDALIAS-vendor_product = affected_vendor AS vendor_product
FIELDALIAS-dest = cve_id AS dest
FIELDALIAS-signature = cve_id AS signature
FIELDALIAS-signature_id = cve_id AS signature_id
FIELDALIAS-category = cwe_id AS category

#
# Error Sourcetype
#
[cveicu:error]
SHOULD_LINEMERGE = false
LINE_BREAKER = ([\r\n]+)
NO_BINARY_CHECK = true
TIME_FORMAT = %Y-%m-%dT%H:%M:%S.%3N%Z
TIME_PREFIX = "timestamp"\s*:\s*"
MAX_TIMESTAMP_LOOKAHEAD = 64
TZ = UTC
KV_MODE = json

#
# Audit Sourcetype
#
[cveicu:audit]
SHOULD_LINEMERGE = false
LINE_BREAKER = ([\r\n]+)
NO_BINARY_CHECK = true
TIME_FORMAT = %Y-%m-%dT%H:%M:%S.%3N%Z
TIME_PREFIX = "timestamp"\s*:\s*"
MAX_TIMESTAMP_LOOKAHEAD = 64
TZ = UTC
KV_MODE = json
