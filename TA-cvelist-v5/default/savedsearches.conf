# Pre-computed lookup refresh searches for instant dashboard loading
# These scheduled searches update CSV lookups used by the dashboard

[CVE Total Lookup Refresh]
enableSched = 1
cron_schedule = */15 * * * *
dispatch.earliest_time = 0
dispatch.latest_time = now
search = index=main sourcetype="ta:cvelist:v5:record" \
| rex field=_raw "\"cveId\"\s*:\s*\"(?<cve_id>CVE-\d{4}-\d+)\"" \
| rex field=_raw "\"state\"\s*:\s*\"(?<cve_state>PUBLISHED)\"" \
| where cve_state="PUBLISHED" \
| stats dc(cve_id) as total_cves \
| eval last_updated=now() \
| outputlookup cve_total.csv

[CVE Daily Summary Lookup Refresh]
enableSched = 1
cron_schedule = 5 * * * *
dispatch.earliest_time = 0
dispatch.latest_time = now
search = index=main sourcetype="ta:cvelist:v5:record" \
| rex field=_raw "\"cveId\"\s*:\s*\"(?<cve_id>CVE-\d{4}-\d+)\"" \
| rex field=_raw "\"state\"\s*:\s*\"(?<cve_state>PUBLISHED)\"" \
| rex field=_raw "\"datePublished\"\s*:\s*\"(?<date_published>\d{4}-\d{2}-\d{2})" \
| rex field=_raw "\"baseSeverity\"\s*:\s*\"(?<severity>CRITICAL|HIGH|MEDIUM|LOW)\"" \
| where cve_state="PUBLISHED" AND isnotnull(date_published) \
| eval severity=if(isnull(severity), "NONE", severity) \
| stats dc(cve_id) as cve_count by date_published severity \
| outputlookup cve_daily_summary.csv

[CVE Vendors Lookup Refresh]
enableSched = 1
cron_schedule = 10 * * * *
dispatch.earliest_time = -30d@d
dispatch.latest_time = now
search = index=main sourcetype="ta:cvelist:v5:record" \
| rex field=_raw "\"cveId\"\s*:\s*\"(?<cve_id>CVE-\d{4}-\d+)\"" \
| rex field=_raw "\"state\"\s*:\s*\"(?<cve_state>PUBLISHED)\"" \
| rex field=_raw "\"vendor\"\s*:\s*\"(?<vendor>[^\"]+)\"" \
| where cve_state="PUBLISHED" AND isnotnull(vendor) AND vendor!="n/a" \
| stats dc(cve_id) as cve_count by vendor \
| sort - cve_count \
| head 50 \
| outputlookup cve_vendors.csv

